<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    

    <title>Direct3D 11高级教程之DXUT篇（三上） | 绣湖小屋</title>
    <meta property="og:title" content="Direct3D 11高级教程之DXUT篇（三上） - 绣湖小屋">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2021-02-27T10:28:15&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2021-02-27T10:28:15&#43;08:00'>
        
    <meta name="Keywords" content="Web,JavaScript,C语言,C&#43;&#43;,Python,专业引擎,alexwoo1900">
    <meta name="description" content="Direct3D 11高级教程之DXUT篇（三上）">
        
    <meta name="author" content="Alex Woo">
    <meta property="og:url" content="https://alexwoo1900.github.io/post/202102271028/">
    <link rel="shortcut icon" href='/favicon.ico'  type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <link rel="stylesheet" href='/css/prism.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
    
    
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://alexwoo1900.github.io">
                        绣湖小屋
                    </a>
                
                <p class="description">专注于Web软件开发、桌面软件开发，不限语言</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://alexwoo1900.github.io">首页</a>
                    
                    <a  href="https://alexwoo1900.github.io/tools/" title="工具">工具</a>
                    
                    <a  href="https://alexwoo1900.github.io/archives/" title="归档">归档</a>
                    
                    <a  href="https://alexwoo1900.github.io/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    
    <article class="post">
        <header>
            <h1 class="post-title">Direct3D 11高级教程之DXUT篇（三上）</h1>
        </header>
        <date class="post-meta meta-date">
            2021年2月27日
        </date>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-content">
            <h2 id="前言">前言</h2>
<p>本系列博文为Github上directx-sdk-samples项目附带教程的译文。<br>
翻译范围为DXUT部分的Tutorial 08 ~ 10和FX部分的Tutorial 11 ~ 14。<br>
为使得读者能更加流畅地阅览中文版本，译者在翻译时对部分原文作了意译处理，故给出英文原版方便读者对照。</p>
<h2 id="正文">正文</h2>
<p>Tutorial10</p>
<p>教程10</p>
<p>This tutorial covers the advanced DXUT concepts.<br>
Most of the functionality that is demonstrated in this tutorial is optional. However, it can be used to enhance your application with minimal cost.<br>
DXUT provides a simple sprite based GUI system and a device settings dialog.<br>
In addition, it provides a few types of camera classes.</p>
<p>本篇教程涵盖DXUT框架中的高级概念。<br>
虽然演示的绝大多数功能都是可选的，但使用它们能以最小的成本增强你的应用程序。<br>
DXUT框架提供一个简单的基于精灵的图形界面系统和设备配置对话框。<br>
另外，它还提供一些摄像机相关的类。</p>
<p>In this tutorial, you create a fully functional GUI to modify settings by using the device and scene.<br>
There will be buttons, sliders, and text to demonstrate these capabilities.</p>
<p>在本教程里，你会创建一个全功能图形界面来修改供设备或者场景使用的配置参数。<br>
代码中会创建一些按钮、滑动条以及文本来演示这些功能。</p>
<h3 id="dxut摄像机">DXUT摄像机</h3>
<p>The CModelViewerCamera class within DXUT is provided to simplify the management of the view and projection transformations.<br>
It also provides GUI functionality.</p>
<p>DXUT框架的CModelViewerCamera类为开发者管理视图矩阵和投影矩阵提供了一种简单的方式。<br>
它也同样具有图形界面。</p>
<pre><code class="language-cpp">CModelViewerCamera g_Camera;  // A model viewing camera
</code></pre>
<p>The first function that the camera provides is the creation of the view and projection matrices.<br>
With the camera, there is no need to worry about these matrices. Instead, specify the viewer location, the view itself, and the size of the window. Then, pass these parameters to the camera object, which creates the matrices behind the scene.</p>
<p>摄像机类提供的第一种函数就是视图矩阵和投影矩阵的构造函数。<br>
使用了摄像机类，就再也不用担心这些矩阵了，只需要指定观察者（视图矩阵参数），视域（投影矩阵参数）以及窗口大小，然后把这些参数传给摄像机对象，它就会在后台自动创建相关的矩阵。</p>
<p>The following example sets the view portion of the camera. This includes location and view.</p>
<p>下面的例子是设置摄像机视图部分的参数，包括摄像机的位置向量（eye）和视线向量（lookat）。</p>
<pre><code class="language-cpp">// Initialize the camera
static const XMVECTORF32 s_Eye = { 0.0f, 3.0f, -800.0f, 0.f };
static const XMVECTORF32 s_At = { 0.0f, 1.0f, 0.0f, 0.f };
g_Camera.SetViewParams( s_Eye, s_At );
</code></pre>
<p>Next, specify the projection portion of the camera. We need to provide the viewing angle, the aspect ratio, and the near and far clipping planes for the view frustum.<br>
This is the same information that was required in previous tutorials. However, in this tutorial we do not worry about creating the matrices themselves.</p>
<p>然后是摄像机的投影部分。我们需要提供视场角（fov）、屏幕宽高比（aspect ratio）和截锥视景体的远近裁剪平面（near &amp; far）。<br>
这些跟先前教程所需要的信息是一样的。但是在这里你不用直接构造矩阵本身。</p>
<pre><code class="language-cpp">// Setup the camera's projection parameters
float fAspectRatio = pBackBufferSurfaceDesc-&gt;Width / (FLOAT)pBackBufferSurfaceDesc-&gt;Height;

g_Camera.SetProjParams( XM_PI / 4, fAspectRatio, 0.1f, 1000.0f );

g_Camera.SetWindow( pBackBufferSurfaceDesc-&gt;Width, pBackBufferSurfaceDesc-&gt;Height );
</code></pre>
<p>The camera also creates masks for simple mouse feedback.<br>
Here, we specify three mouse buttons to utilize for the mouse operations that are provided—model rotation, zooming, and camera rotation.<br>
Try compiling the project and playing with each button to understand what each operation does.</p>
<p>摄像机还为简单的鼠标反馈创建了掩码。<br>
在代码中我们为模型旋转、拉伸视距、视角旋转这些功能指定了三种鼠标按钮操作方式。</p>
<pre><code class="language-cpp">g_Camera.SetButtonMasks( MOUSE_LEFT_BUTTON, MOUSE_WHEEL, MOUSE_MIDDLE_BUTTON );
</code></pre>
<p>After the buttons are set, the camera listens for mouse inputs and acts accordingly.<br>
To respond to user input, add a listener to the MsgProc callback function. This is the function that DXUT routes messages to.</p>
<p>某个按钮被触发时，摄像机会监听到具体的鼠标输入并作出相应动作。
要响应用户的输入，需要将监听器加入到MsgProc回调函数中。那也是DXUT框架传递消息的目的地。</p>
<pre><code class="language-cpp">// Pass all remaining windows messages to camera so it can respond
// to user input
g_Camera.HandleMessages( hWnd, uMsg, wParam, lParam );
</code></pre>
<p>Finally, after all the required data is entered into the camera, we extract the actual matrices for the transformations.<br>
We grab the projection matrix and the view matrix, together with the associated functions.<br>
The camera object is responsible for computing the matrices themselves.</p>
<p>最后，摄像机得到了需要的数据，我们需要把生成的矩阵从它里面取出来。<br>
我们用相关的函数就可以把视图矩阵和投影矩阵获取到。<br>
摄像机对象负责计算矩阵本身。</p>
<pre><code class="language-cpp">XMMATRIX mView = g_Camera.GetViewMatrix();
XMMATRIX mProj = g_Camera.GetProjMatrix();
XMMATRIX mWorldViewProjection = g_World * mView * mProj;
</code></pre>
<h3 id="dxut对话框">DXUT对话框</h3>
<p>User interaction can be accomplished by using the CDXUTDialog class.<br>
This contains controls in a dialog that accepts user input, and passes it to the application to handle.<br>
First, the dialog class is instantiated. Then, individual controls can be added.</p>
<p>用户交互可以通过使用CDXUTDialog类实现。<br>
这个类提供可以包含许多控件的对话框，这种对话框可以接收用户的输入并将其传递给应用程序处理。<br>
我们首先要做的是让对话框类被实例化，然后往里面添加独立控件。</p>
<h4 id="对象声明">对象声明</h4>
<p>In this tutorial, two dialogs are added.<br>
One is called g_HUD, and it contains the same code as the Direct3D 11 samples.<br>
The other is called g_SampleUI, and it demonstrates functions that are specific to this tutorial.<br>
The second dialog is used to control the &ldquo;puffiness&rdquo; of the model. It sets a variable that is passed into the shaders.</p>
<p>本教程里面会添加两个对话框。<br>
一个命名为g_HUD，它的代码和Direct3D 11的示例一样。
另一个命名为g_SampleUI，它用来展示本教程中特有的功能。具体地说，它被用来控制模型的“膨胀程度”。<br>
第二个对话框里设置的参数最终会传递给着色器。</p>
<pre><code class="language-cpp">CDXUTDialog g_HUD;      // manages the 3D UI
CDXUTDialog g_SampleUI; // dialog for sample specific controls
</code></pre>
<p>The dialogs are controlled by a class called CDXUTDialogResourceManager.<br>
It passes messages and handles resources that are shared by the dialogs.</p>
<p>这些对话框是由一个叫CDXUTDialogResourceManager的类进行管理。<br>
它负责传递消息和处理对话框共享的资源。</p>
<pre><code class="language-cpp">CDXUTDialogResourceManager g_DialogResourceManager; // manager for shared resources of dialogs
</code></pre>
<p>Finally, a new callback function is associated with the events that are processed by the GUI.<br>
This function is used to handle the interaction between the controls.</p>
<p>最后我们会用一个新的回调函数来关联图形界面的事件。<br>
这个函数用来处理控件间的交互。</p>
<pre><code class="language-cpp">void CALLBACK OnGUIEvent( UINT nEvent, int nControlID, CDXUTControl* pControl, void* pUserContext );
</code></pre>
<h4 id="对话框初始化">对话框初始化</h4>
<p>Because more utilities have been introduced, and need to be initialized, this tutorial moves the initialization of these modules to a separate function, called InitApp().</p>
<p>因为介绍的模块越来越多，而它们都需要进行初始化。所以本教程把这些初始化过程统统放在一个叫InitApp的独立函数里。</p>
<p>The controls for each dialog are initialized inside this function.<br>
Each dialog calls its Init function, and passes in the resource manager to specify where the control should be placed.<br>
It also sets the callback function to process the GUI responses. In this case, the associated callback function is OnGUIEvent.</p>
<p>每个对话框中的控件都要在InitApp里面进行初始化。<br>
每个对话框都要调用它们的初始化函数，并将资源管理器作为参数传进去，指明里面的控件应该要放在哪里。<br>
对话框也可以设置回调函数来响应图形界面的事件，在这里，这个回调函数就是OnGUIEvent。</p>
<pre><code class="language-cpp">g_HUD.Init( &amp;g_DialogResourceManager );
g_SampleUI.Init( &amp;g_DialogResourceManager );
g_HUD.SetCallback( OnGUIEvent );
g_SampleUI.SetCallback( OnGUIEvent );
</code></pre>
<p>After each dialog is initialized, it can insert the controls to use.<br>
The HUD adds three buttons for the basic functionality: toggle fullscreen, toggle reference (software) renderer, and change device.<br>
To add a button, specify the IDC identifier to use, a string to display, the coordinates, the width and length, and optionally a keyboard shortcut to associate with the button.<br>
Note that the coordinates are relative to the anchor of the dialog.</p>
<p>每一个对话框经过初始化之后就可以放入控件使用了。<br>
g_HUD为切换全屏、切换渲染、调节设备这些基础功能添加了三个按钮。<br>
每加入一个按钮，就要为其指定IDC标识、用于显示的字符串、位置坐标、按钮宽高以及绑定的快捷键。<br>
要注意的是位置坐标是相对于对话框锚点的数值。</p>
<pre><code class="language-cpp">int iY = 10;
g_HUD.AddButton( IDC_TOGGLEFULLSCREEN, L&quot;Toggle full screen&quot;, 0, iY, 170, 22 );
g_HUD.AddButton( IDC_CHANGEDEVICE, L&quot;Change device (F2)&quot;, 0, iY += 26, 170, 22, VK_F2 );
g_HUD.AddButton( IDC_TOGGLEREF, L&quot;Toggle REF (F3)&quot;, 0, iY += 26, 170, 22, VK_F3 );
g_HUD.AddButton( IDC_TOGGLEWARP, L&quot;Toggle WARP (F4)&quot;, 0, iY += 26, 170, 22, VK_F4 ); 
</code></pre>
<p>Similarly for the sample UI, three controls are added—one static text, one slider, and one checkbox.<br>
The static text parameters are the IDC identifier, the string, the coordinates, and the width and height.<br>
The slider parameters are the IDC identifier, the coordinates, the width and height, then the min and max values of the slider, and finally the variable to store the result.<br>
The checkbox parameters are the IDC identifier, a string label, the coordinates, the width and height, and the Boolean variable to store the result.</p>
<p>g_Sample也以类似的方式添加三个控件，分别是一个静态文本、一个滑动条和一个勾选框。<br>
静态文本的参数有IDC标识，字符串，坐标和文本宽高。<br>
滑动条的参数除了IDC标识，坐标，滑动条宽高，还有滑动条的最大最小值，以及最终用来保存结果的变量。<br>
勾选框参数有IDC标识，字符串标签、坐标和控件宽高，还有用来保存结果的布尔变量。<br>
（这种“保存结果”的方式并不是指变量以指针传入再赋值，实际上，变量是在对话框回调函数中被赋值的）</p>
<pre><code class="language-cpp">iY = 10;
WCHAR sz[100];
iY += 24;
swprintf_s( sz, 100, L&quot;Puffiness: %0.2f&quot;, g_fModelPuffiness );
g_SampleUI.AddStatic( IDC_PUFF_STATIC, sz, 0 , iY += 26, 170, 22 );
g_SampleUI.AddSlider( IDC_PUFF_SCALE, 50, iY += 26, 100, 22, 0, 2000, ( int )( g_fModelPuffiness * 100.0f ) );
iY += 24;
g_SampleUI.AddCheckBox( IDC_TOGGLESPIN, L&quot;Toggle Spinning&quot;, 0, iY += 26, 170, 22, g_bSpinning );
</code></pre>
<p>After the dialogs are initialized, they must be placed on the screen.<br>
This is done during the <code>OnD3D11ResizedSwapChain</code> call, because the screen coordinates can change every time the swap chain is recreated—for example, if the window is resized.</p>
<p>对话框被初始化之后，还要布置在屏幕里面。<br>
这一步在<code>OnD3D11ResizedSwapChain</code>调用里面完成，因为每次交换链被重建的时候（比如改变窗口大小）屏幕坐标都会改变。</p>
<pre><code class="language-cpp">g_HUD.SetLocation( pBackBufferSurfaceDesc-&gt;Width-170, 0 );
g_HUD.SetSize( 170, 170 );
g_SampleUI.SetLocation( pBackBufferSurfaceDesc-&gt;Width-170, pBackBufferSurfaceDesc-&gt;Height-300 );
g_SampleUI.SetSize( 170, 300 );
</code></pre>
<p>Finally, the dialogs must be identified in the <code>OnD3D11FrameRender</code> function.<br>
This allows the dialogs to be drawn so that the user can actually see them.</p>
<p>最后，这些对话框必须在<code>OnD3D11FrameRender</code>函数中进行渲染。<br>
绘制过后的对话框才能让人实实在在地看到它们。</p>
<pre><code class="language-cpp">//
// Render the UI
//
g_HUD.OnRender( fElapsedTime ); 
g_SampleUI.OnRender( fElapsedTime ); 
</code></pre>

        </div>

        
<div class="post-archive">
    <ul class="post-copyright">
        <li><strong>原文作者：</strong><a rel="author" href="https://alexwoo1900.github.io">Alex Woo</a></li>
        <li style="word-break:break-all"><strong>原文链接：</strong><a href="https://alexwoo1900.github.io/post/202102271028/">https://alexwoo1900.github.io/post/202102271028/</a></li>
        <li><strong>版权声明：</strong>本作品采用<a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可，非商业转载请注明出处（作者，原文链接），商业转载请联系作者获得授权。</li>
    </ul>
</div>
<br/>



        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/post/202102261010/">Direct3D 11高级教程之DXUT篇（二）</a></li>
        
        <li><a href="/post/202012211431/">Direct3D 11高级教程之DXUT篇（一）</a></li>
        
        <li><a href="/post/202012011356/">决战紫禁之巅与贝叶斯理论</a></li>
        
        <li><a href="/post/202011231012/">高效矩阵计算</a></li>
        
        <li><a href="/post/202011031500/">解读传统光栅化 - mini3d代码全剖析</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            没有标签
            
        </div>
    </article>
    
    

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo = "alexwoo1900/alexwoo1900.github.io"
            issue-term = "pathname"
            theme = "github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    


</div>

                    <footer id="footer">
    <div>
        &copy; 2021 <a href="https://alexwoo1900.github.io">绣湖小屋 By Alex Woo</a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='/js/prism.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>



    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://alexwoo1900.github.io/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://alexwoo1900.github.io">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://alexwoo1900.github.io/post/202102271028/" title="Direct3D 11高级教程之DXUT篇（三上）">Direct3D 11高级教程之DXUT篇（三上）</a>
    </li>
    
    <li>
        <a href="https://alexwoo1900.github.io/post/202102261010/" title="Direct3D 11高级教程之DXUT篇（二）">Direct3D 11高级教程之DXUT篇（二）</a>
    </li>
    
    <li>
        <a href="https://alexwoo1900.github.io/post/202012211431/" title="Direct3D 11高级教程之DXUT篇（一）">Direct3D 11高级教程之DXUT篇（一）</a>
    </li>
    
    <li>
        <a href="https://alexwoo1900.github.io/post/202012011356/" title="决战紫禁之巅与贝叶斯理论">决战紫禁之巅与贝叶斯理论</a>
    </li>
    
    <li>
        <a href="https://alexwoo1900.github.io/post/202011231012/" title="高效矩阵计算">高效矩阵计算</a>
    </li>
    
    <li>
        <a href="https://alexwoo1900.github.io/post/202011031500/" title="解读传统光栅化 - mini3d代码全剖析">解读传统光栅化 - mini3d代码全剖析</a>
    </li>
    
    <li>
        <a href="https://alexwoo1900.github.io/post/202010281458/" title="国内开源镜像站列表">国内开源镜像站列表</a>
    </li>
    
    <li>
        <a href="https://alexwoo1900.github.io/post/202010281058/" title="Discuz论坛搬迁记录">Discuz论坛搬迁记录</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href='/categories/'>分类</a></h3>
<ul class="widget-list">
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/tags/'>标签</a></h3>
<div class="tagcloud">
    
</div>
    </section>

    
<section class="widget">
    <h3 class="widget-title">友情链接</h3>
    <ul class="widget-list">
        
        <li>
            <a target="_blank" href="https://alexwoo1900.github.io/" title="绣湖小屋">绣湖小屋</a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://alexwoo1900.github.io/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>